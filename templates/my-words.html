<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!--bulma css-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

    <title>두유노우? | 내단어장</title>

    <!--구글폰트-->
    <link href="https://fonts.googleapis.com/css?family=Jua:400" rel="stylesheet">

    <script>
        //페이지 새로고침 시 자동으로 get_mywords()함수가 실행된다.
        $(document).ready(function () {
            get_mywords();
        });

        //likes, posts DB에 있는 값들을 각각 불러와서 보여주는 함수이다.
        function get_mywords(username) {
            $.ajax({
                type: "GET",
                url: `/my-words?username_give=${username}`,
                data: {},
                success: function (response) {
                    if (response["result"] == 'success') {
                        let user_likes = response["all_likes"]
                        let all_posts = response["all_posts"]

                        for (let i = 0; i < user_likes.length; i++) {
                            let post_id = user_likes[i]['post_id']
                            let english = all_posts[i]['english']
                            let korean = all_posts[i]['korean']
                            let image = all_posts[i]['image']

                            let eng = english.split(',')
                            let kor = korean.split(',')


                            let temp_html1 = `<div class="row gx-4 gx-lg-5 align-items-center my-5" id="${post_id}">
                                                <div class="A col-lg-7"><img class="img-fluid rounded mb-4 mb-lg-0"
                                                                           src="${image}" alt="..."/>
                                                </div>`

                            let temp_html3 = `<div>
                                                    <button class=" button is-primary" onclick="delete_mywords('${post_id}')">학습 완료!</button>
                                                </div>
                                            </div>`
                            $('#mywords').append(temp_html1)
                            let temp_html2 = ``
                            for (let j = 0; j < eng.length; j++) {
                                temp_html2 = `<div class="A col-lg-5" id="list">
                                                    <ul class="list-group">
                                                        <li class="list-group-item">${eng[j]}</li>
                                                        <li class="list-group-item">${kor[j]}</li>
                                                    </ul>
                                                </div>`
                                $('#mywords').append(temp_html2)
                            }
                            $('#mywords').append(temp_html3)

                        }
                    }
                }
            })
        }
        // likes DB에서 해당 게시물 내용을 없애주기
        function delete_mywords(post_id) {
            $.ajax({
                type: "POST",
                url: '/my-words/delete',
                data: {post_id_give: post_id},
                success: function (response) {
                    alert(response["msg"])
                    window.location.reload();
                }
            })
        }
    </script>

    <style>
        * {
            font-family: 'Jua', cursive;
        }

        .title {
            font-size: 60px;
        }

    </style>

</head>
<body>
<section class="hero is-primary is-medium">
    <div class="hero-body">
        <p class="title">
            {{ username }}님의 단어장
        </p>
        <p class="subtitle">
            오늘 당신이 학습할 내용은?
        </p>
        <p class="subtitle">
            <a href="/">메인으로 돌아가기✌</a>
        </p>
    </div>
</section>

<div id="mywords">
</div>
<!— Option 1: Bootstrap Bundle with Popper —>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
</body>
</html>
